{% extends "blog/base.html" %}

{% block content %}
  <div class="row justify-content-center">
    <div class="col-lg-8">

      <div class="card card-post mb-4">
        {% if post.image %}
          <div style="width: 100%; height: 400px; overflow: hidden; border-radius: 1rem 1rem 0 0;">
            <img src="{{ post.image.url }}" alt="{{ post.title }}" class="card-post-image" style="width: 100%; height: 100%; object-fit: cover;">
          </div>
        {% else %}
          <div style="width: 100%; height: 400px; background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); border-radius: 1rem 1rem 0 0; display: flex; align-items: center; justify-content: center;">
            <span style="font-size: 6rem; opacity: 0.2;">ğŸ“„</span>
          </div>
        {% endif %}

        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <div>
              {% if post.category %}
                <span class="badge bg-primary">
                  {{ post.category.name }}
                </span>
              {% endif %}
            </div>
          </div>

          <h1 class="card-title mb-3">{{ post.title }}</h1>

          <div style="border-bottom: 2px solid #e2e8f0; padding-bottom: 1.5rem; margin-bottom: 2rem;">
            <p class="text-muted-date mb-0">
              ğŸ“… {{ post.created_at|date:"d \d\e F \d\e Y" }} a las {{ post.created_at|date:"H:i" }}<br>
              âœï¸ Por <strong style="color: var(--primary-dark);">{{ post.author.username }}</strong>
            </p>
          </div>

          <div class="card-text" style="font-size: 1.05rem; line-height: 1.8; color: #374151;">
            {{ post.content|linebreaks }}
          </div>
        </div>
        
        <div class="card-footer bg-light d-flex justify-content-between align-items-center">
          <div>
            {% if user.is_authenticated %}
              {% if user.is_superuser %}
                <a href="{% url 'blog:post_update' post.slug %}" class="btn btn-sm btn-warning" style="font-weight: 600;">âœï¸ Editar</a>
                <a href="{% url 'blog:post_delete' post.slug %}" class="btn btn-sm btn-danger" style="font-weight: 600;">ğŸ—‘ï¸ Borrar</a>
              {% elif post.author == user %}
                {% if user.profile and user.profile.is_collaborator %}
                  <a href="{% url 'blog:post_update' post.slug %}" class="btn btn-sm btn-warning" style="font-weight: 600;">âœï¸ Editar</a>
                  <a href="{% url 'blog:post_delete' post.slug %}" class="btn btn-sm btn-danger" style="font-weight: 600;">ğŸ—‘ï¸ Borrar</a>
                {% endif %}
              {% endif %}
            {% endif %}
          </div>
          <a href="{% url 'blog:home' %}" class="btn btn-outline-secondary btn-sm" style="font-weight: 600;">
            â† Volver a artÃ­culos
          </a>
        </div>
      </div>
      
      <!-- Comentarios -->
      <div class="mt-5">
        <h2 class="mb-4" style="font-weight: 800; color: var(--primary-dark); font-size: 1.8rem;">ğŸ’¬ Comentarios</h2>
        
        {% if comments %}
          <div class="mb-4">
            {% for comment in comments %}
              <div class="card mb-3" style="border: 1px solid #e2e8f0; border-radius: 0.75rem; transition: all 0.3s ease;">
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <div>
                      <strong style="color: var(--primary-dark); font-size: 1.05rem;">{{ comment.author.username }}</strong>
                      <span class="text-muted-date"> Â· {{ comment.created_at|date:"d/m/Y H:i" }}</span>
                    </div>
                    <div>
                      {% if user.is_authenticated %}
                        {% if comment.author == user %}
                          <a href="{% url 'blog:comment_edit' comment.pk %}" class="btn btn-sm btn-link" style="font-weight: 500;">Editar</a>
                          <a href="{% url 'blog:comment_delete' comment.pk %}" class="btn btn-sm btn-link text-danger" style="font-weight: 500;">Borrar</a>
                        {% elif user.is_superuser %}
                          <a href="{% url 'blog:comment_edit' comment.pk %}" class="btn btn-sm btn-link" style="font-weight: 500;">Editar</a>
                          <a href="{% url 'blog:comment_delete' comment.pk %}" class="btn btn-sm btn-link text-danger" style="font-weight: 500;">Borrar</a>
                        {% elif post.author == user %}
                          {% if user.profile and user.profile.is_collaborator %}
                            <a href="{% url 'blog:comment_edit' comment.pk %}" class="btn btn-sm btn-link" style="font-weight: 500;">Editar</a>
                            <a href="{% url 'blog:comment_delete' comment.pk %}" class="btn btn-sm btn-link text-danger" style="font-weight: 500;">Borrar</a>
                          {% endif %}
                        {% endif %}
                      {% endif %}
                    </div>
                  </div>
                  <div class="mt-2" style="color: #374151; line-height: 1.6;">
                    {{ comment.content|linebreaks }}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-info" style="border-left: 4px solid var(--primary); background-color: #f0f4f8; border-radius: 0.5rem;">
            <strong>â„¹ï¸ Sin comentarios aÃºn</strong><br>
            SÃ© el primero en comentar sobre este artÃ­culo.
          </div>
        {% endif %}

        {% if user.is_authenticated %}
          <div class="card" style="border-radius: 1rem; border: 1px solid #e2e8f0; margin-top: 2rem; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
            <div class="card-body">
              <h5 class="card-title mb-4" style="font-weight: 700; color: var(--primary-dark);">Dejar un comentario</h5>
              <form method="post">
                {% csrf_token %}
                {{ form.non_field_errors }}
                <div class="mb-3">
                  {{ form.content }}
                  {% for error in form.content.errors %}
                    <div class="text-danger small mt-1">{{ error }}</div>
                  {% endfor %}
                </div>
                <button class="btn btn-primary" type="submit" style="font-weight: 600; padding: 0.6rem 1.5rem;">
                  ğŸ“¤ Enviar comentario
                </button>
              </form>
            </div>
          </div>
        {% else %}
          <div class="alert alert-warning" style="border-left: 4px solid #f59e0b; background-color: #fef3c7; border-radius: 0.5rem;">
            <strong>âš ï¸ Debes iniciar sesiÃ³n</strong><br>
            <a href="{% url 'login' %}" style="color: var(--primary-dark); font-weight: 600;">Inicia sesiÃ³n</a> o 
            <a href="{% url 'blog:signup' %}" style="color: var(--primary-dark); font-weight: 600;">regÃ­strate</a> para comentar.
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}
