{% extends "blog/base.html" %}

{% block content %}
  <div class="row justify-content-center">
    <div class="col-lg-3">
      <aside class="sticky-top" style="top: 20px;">
        <div class="card" style="border-radius: 1rem; border: 1px solid #e2e8f0; box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
          <div class="card-body">
            <h6 class="card-title mb-3" style="font-weight: 700; color: #1e40af;">Filtros</h6>
            
            <div class="mb-4">
              <label class="form-label" style="font-weight: 600; font-size: 0.9rem; color: #374151;">Categor√≠as</label>
              <div class="dropdown">
                <button class="btn btn-outline-secondary dropdown-toggle w-100 text-start" type="button" id="categoriesDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                  {% if current_category %}
                    {% for cat in categories %}
                      {% if current_category == cat.slug %}{{ cat.name }}{% endif %}
                    {% endfor %}
                  {% else %}
                    Todas las categor√≠as
                  {% endif %}
                </button>
                <ul class="dropdown-menu w-100" aria-labelledby="categoriesDropdown" style="max-height:320px;overflow-y:auto;">
                  <li><a class="dropdown-item {% if not current_category %}active{% endif %}" href="{% url 'blog:home' %}">Todas las categor√≠as</a></li>
                  <li><hr class="dropdown-divider"></li>
                  {% for cat in categories %}
                    <li class="{% if current_category == cat.slug %}active{% endif %}">
                      <a class="dropdown-item {% if current_category == cat.slug %}active{% endif %}" href="{% url 'blog:category_posts' cat.slug %}">{{ cat.name }}</a>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>

            <div>
              <label class="form-label" style="font-weight: 600; font-size: 0.9rem; color: #374151;">Ordenar por</label>
              <form method="get" class="mb-0">
                <input type="hidden" name="category" value="{{ current_category }}">
                <select name="order" class="form-select" onchange="this.form.submit()">
                  <option value="date_desc" {% if current_order == 'date_desc' %}selected{% endif %}>üìÖ M√°s recientes</option>
                  <option value="date_asc" {% if current_order == 'date_asc' %}selected{% endif %}>üìÖ M√°s antiguos</option>
                  <option value="title_asc" {% if current_order == 'title_asc' %}selected{% endif %}>üî§ T√≠tulo A-Z</option>
                  <option value="title_desc" {% if current_order == 'title_desc' %}selected{% endif %}>üî§ T√≠tulo Z-A</option>
                </select>
              </form>
            </div>
          </div>
        </div>
      </aside>
    </div>
    <div class="col-lg-6">
      <h1 class="page-title">üì∞ √öltimos art√≠culos</h1>

      {% if user.is_authenticated %}
        {% if user.is_superuser %}
          <div class="mb-4">
            <a href="{% url 'blog:post_create' %}" class="btn btn-success btn-lg">
              <span style="font-size: 1.1rem;">‚ûï</span> Crear art√≠culo
            </a>
          </div>
        {% else %}
          {% if user.profile and user.profile.is_collaborator %}
            <div class="mb-4">
              <a href="{% url 'blog:post_create' %}" class="btn btn-success btn-lg">
                <span style="font-size: 1.1rem;">‚ûï</span> Crear art√≠culo
              </a>
            </div>
          {% endif %}
        {% endif %}
      {% endif %}

      {% if posts %}
        <div class="posts-grid">
          {% for post in posts %}
            <a href="{% url 'blog:post_detail' post.slug %}" class="text-decoration-none text-dark">
              <div class="card card-post mb-4">
                {% if post.image %}
                  <div style="width: 100%; height: 280px; overflow: hidden; border-radius: 1rem 1rem 0 0;">
                    <img src="{{ post.image.url }}" alt="{{ post.title }}" class="card-post-image" style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s ease;">
                  </div>
                {% else %}
                  <div style="width: 100%; height: 280px; background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); border-radius: 1rem 1rem 0 0; display: flex; align-items: center; justify-content: center;">
                    <span style="font-size: 4rem; opacity: 0.2;">üìÑ</span>
                  </div>
                {% endif %}
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    {% if post.category %}
                      <span class="badge bg-primary">
                        {{ post.category.name }}
                      </span>
                    {% endif %}
                  </div>
                  <h3 class="card-title mb-2">{{ post.title }}</h3>
                  <p class="text-muted-date mb-2">
                    üìÖ {{ post.created_at|date:"d/m/Y" }} ‚Ä¢ Por <strong>{{ post.author.username }}</strong>
                  </p>
                  <p class="card-text text-secondary mb-0">
                    {{ post.content|truncatechars:140 }}
                  </p>
                </div>
              </div>
            </a>
          {% endfor %}
        </div>

        {% if is_paginated %}
          <nav aria-label="Page navigation" class="mt-5">
            <ul class="pagination justify-content-center">
              {% if posts.has_previous %}
                <li class="page-item">
                  <a class="page-link" href="{% if request.GET %}?{{ request.GET.urlencode }}&page={{ posts.previous_page_number }}{% else %}?page={{ posts.previous_page_number }}{% endif %}">‚Üê Anterior</a>
                </li>
              {% else %}
                <li class="page-item disabled"><span class="page-link">‚Üê Anterior</span></li>
              {% endif %}

              {% for num in posts.paginator.page_range %}
                {% if num == posts.number %}
                  <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                {% else %}
                  <li class="page-item"><a class="page-link" href="{% if request.GET %}?{{ request.GET.urlencode }}&page={{ num }}{% else %}?page={{ num }}{% endif %}">{{ num }}</a></li>
                {% endif %}
              {% endfor %}

              {% if posts.has_next %}
                <li class="page-item">
                  <a class="page-link" href="{% if request.GET %}?{{ request.GET.urlencode }}&page={{ posts.next_page_number }}{% else %}?page={{ posts.next_page_number }}{% endif %}">Siguiente ‚Üí</a>
                </li>
              {% else %}
                <li class="page-item disabled"><span class="page-link">Siguiente ‚Üí</span></li>
              {% endif %}
            </ul>
          </nav>
        {% endif %}
      {% else %}
        <div class="alert alert-info" style="border-left: 4px solid var(--primary); background-color: #f0f4f8; border-radius: 0.5rem;">
          <strong>‚ÑπÔ∏è Sin art√≠culos</strong><br>
          Todav√≠a no hay art√≠culos publicados. Pronto vas a ver contenido sobre entrenamiento,
          alimentaci√≥n y descanso. ¬°Vuelve pronto!
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}
